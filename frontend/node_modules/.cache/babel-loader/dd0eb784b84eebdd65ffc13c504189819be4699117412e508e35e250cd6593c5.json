{"ast":null,"code":"var _jsxFileName = \"E:\\\\Grocery\\\\frontend\\\\src\\\\page\\\\Cart.js\",\n  _s = $RefreshSig$();\nimport React from \"react\";\nimport { useSelector } from \"react-redux\";\nimport CartProduct from \"../component/cartProduct\";\nimport emptyCartImage from \"../assest/empty.gif\";\nimport { toast } from \"react-hot-toast\";\nimport { loadStripe } from \"@stripe/stripe-js\";\nimport { useNavigate } from \"react-router-dom\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst Cart = () => {\n  _s();\n  const productCartItem = useSelector(state => state.product.cartItem);\n  const user = useSelector(state => state.user);\n  const navigate = useNavigate();\n  const totalPrice = productCartItem.reduce((acc, curr) => acc + parseInt(curr.total), 0);\n  const totalQty = productCartItem.reduce((acc, curr) => acc + parseInt(curr.qty), 0);\n  const saveOrder = async items => {\n    const userId = localStorage.getItem(\"userId\"); // Get user ID from local storage\n    const totalAmount = totalPrice; // Use total price calculated\n\n    const orderData = {\n      userId,\n      items,\n      totalAmount\n    };\n    try {\n      const response = await fetch(`${process.env.REACT_APP_SERVER_DOMAIN}/save-order`, {\n        method: \"POST\",\n        headers: {\n          \"Content-Type\": \"application/json\",\n          Authorization: `Bearer ${localStorage.getItem(\"token\")}` // Include JWT token for authentication\n        },\n\n        body: JSON.stringify(orderData)\n      });\n      const dataRes = await response.json();\n      if (response.ok) {\n        toast.success(dataRes.message);\n      } else {\n        toast.error(dataRes.message || \"Failed to save order.\");\n      }\n    } catch (error) {\n      console.error(\"Error saving order:\", error);\n      toast.error(\"An error occurred while saving the order.\");\n    }\n  };\n  const handlePayment = async () => {\n    if (user.email) {\n      const stripePromise = await loadStripe(process.env.REACT_APP_STRIPE_PUBLIC_KEY);\n      const res = await fetch(`${process.env.REACT_APP_SERVER_DOMIN}/create-checkout-session`, {\n        method: \"POST\",\n        headers: {\n          \"Content-Type\": \"application/json\"\n        },\n        body: JSON.stringify(productCartItem)\n      });\n      if (res.status === 500) return;\n      const data = await res.json();\n      console.log(data);\n      toast(\"Redirecting to payment gateway...!\");\n\n      // Redirect to Stripe Checkout\n      const {\n        error\n      } = await stripePromise.redirectToCheckout({\n        sessionId: data\n      });\n      if (error) {\n        console.error(\"Stripe checkout error:\", error);\n        toast.error(\"Payment failed.\");\n      } else {\n        // Save the order after successful payment\n        saveOrder(productCartItem);\n      }\n    } else {\n      toast(\"You are not logged in!\");\n      setTimeout(() => {\n        navigate(\"/login\");\n      }, 1000);\n    }\n  };\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"p-2 md:p-4\",\n    children: [/*#__PURE__*/_jsxDEV(\"h2\", {\n      className: \"text-lg md:text-2xl font-bold text-slate-600\",\n      children: \"Your Cart Items\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 103,\n      columnNumber: 7\n    }, this), productCartItem[0] ? /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"my-4 flex gap-3\",\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"w-full max-w-3xl \",\n        children: productCartItem.map(el => /*#__PURE__*/_jsxDEV(CartProduct, {\n          id: el._id,\n          name: el.name,\n          image: el.image,\n          category: el.category,\n          qty: el.qty,\n          total: el.total,\n          price: el.price\n        }, el._id, false, {\n          fileName: _jsxFileName,\n          lineNumber: 112,\n          columnNumber: 15\n        }, this))\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 110,\n        columnNumber: 11\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"w-full max-w-md ml-auto\",\n        children: [/*#__PURE__*/_jsxDEV(\"h2\", {\n          className: \"bg-blue-500 text-white p-2 text-lg\",\n          children: \"Summary\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 127,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"flex w-full py-2 text-lg border-b\",\n          children: [/*#__PURE__*/_jsxDEV(\"p\", {\n            children: \"Total Qty :\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 129,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n            className: \"ml-auto w-32 font-bold\",\n            children: totalQty\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 130,\n            columnNumber: 15\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 128,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"flex w-full py-2 text-lg border-b\",\n          children: [/*#__PURE__*/_jsxDEV(\"p\", {\n            children: \"Total Price\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 133,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n            className: \"ml-auto w-32 font-bold\",\n            children: [/*#__PURE__*/_jsxDEV(\"span\", {\n              className: \"text-red-500\",\n              children: \"\\u20B9\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 135,\n              columnNumber: 17\n            }, this), \" \", totalPrice]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 134,\n            columnNumber: 15\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 132,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n          className: \"bg-red-500 w-full text-lg font-bold py-2 text-white\",\n          onClick: handlePayment,\n          children: \"Payment\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 138,\n          columnNumber: 13\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 126,\n        columnNumber: 11\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 108,\n      columnNumber: 9\n    }, this) : /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"flex w-full justify-center items-center flex-col\",\n      children: [/*#__PURE__*/_jsxDEV(\"img\", {\n        src: emptyCartImage,\n        className: \"w-full max-w-sm\",\n        alt: \"Empty Cart\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 148,\n        columnNumber: 11\n      }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n        className: \"text-slate-500 text-3xl font-bold\",\n        children: \"Empty Cart\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 153,\n        columnNumber: 11\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 147,\n      columnNumber: 9\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 102,\n    columnNumber: 5\n  }, this);\n};\n_s(Cart, \"Yl5//tBfoe2lAQqB3lFiPxF7t08=\", false, function () {\n  return [useSelector, useSelector, useNavigate];\n});\n_c = Cart;\nexport default Cart;\nvar _c;\n$RefreshReg$(_c, \"Cart\");","map":{"version":3,"names":["React","useSelector","CartProduct","emptyCartImage","toast","loadStripe","useNavigate","Cart","productCartItem","state","product","cartItem","user","navigate","totalPrice","reduce","acc","curr","parseInt","total","totalQty","qty","saveOrder","items","userId","localStorage","getItem","totalAmount","orderData","response","fetch","process","env","REACT_APP_SERVER_DOMAIN","method","headers","Authorization","body","JSON","stringify","dataRes","json","ok","success","message","error","console","handlePayment","email","stripePromise","REACT_APP_STRIPE_PUBLIC_KEY","res","REACT_APP_SERVER_DOMIN","status","data","log","redirectToCheckout","sessionId","setTimeout","map","el","_id","name","image","category","price"],"sources":["E:/Grocery/frontend/src/page/Cart.js"],"sourcesContent":["import React from \"react\";\r\nimport { useSelector } from \"react-redux\";\r\nimport CartProduct from \"../component/cartProduct\";\r\nimport emptyCartImage from \"../assest/empty.gif\";\r\nimport { toast } from \"react-hot-toast\";\r\nimport { loadStripe } from \"@stripe/stripe-js\";\r\nimport { useNavigate } from \"react-router-dom\";\r\n\r\nconst Cart = () => {\r\n  const productCartItem = useSelector((state) => state.product.cartItem);\r\n  const user = useSelector((state) => state.user);\r\n  const navigate = useNavigate();\r\n\r\n  const totalPrice = productCartItem.reduce(\r\n    (acc, curr) => acc + parseInt(curr.total),\r\n    0\r\n  );\r\n  const totalQty = productCartItem.reduce(\r\n    (acc, curr) => acc + parseInt(curr.qty),\r\n    0\r\n  );\r\n\r\n  const saveOrder = async (items) => {\r\n    const userId = localStorage.getItem(\"userId\"); // Get user ID from local storage\r\n    const totalAmount = totalPrice; // Use total price calculated\r\n\r\n    const orderData = {\r\n      userId,\r\n      items,\r\n      totalAmount,\r\n    };\r\n\r\n    try {\r\n      const response = await fetch(\r\n        `${process.env.REACT_APP_SERVER_DOMAIN}/save-order`,\r\n        {\r\n          method: \"POST\",\r\n          headers: {\r\n            \"Content-Type\": \"application/json\",\r\n            Authorization: `Bearer ${localStorage.getItem(\"token\")}`, // Include JWT token for authentication\r\n          },\r\n          body: JSON.stringify(orderData),\r\n        }\r\n      );\r\n\r\n      const dataRes = await response.json();\r\n      if (response.ok) {\r\n        toast.success(dataRes.message);\r\n      } else {\r\n        toast.error(dataRes.message || \"Failed to save order.\");\r\n      }\r\n    } catch (error) {\r\n      console.error(\"Error saving order:\", error);\r\n      toast.error(\"An error occurred while saving the order.\");\r\n    }\r\n  };\r\n\r\n  const handlePayment = async () => {\r\n    if (user.email) {\r\n      const stripePromise = await loadStripe(\r\n        process.env.REACT_APP_STRIPE_PUBLIC_KEY\r\n      );\r\n      const res = await fetch(\r\n        `${process.env.REACT_APP_SERVER_DOMIN}/create-checkout-session`,\r\n        {\r\n          method: \"POST\",\r\n          headers: {\r\n            \"Content-Type\": \"application/json\",\r\n          },\r\n          body: JSON.stringify(productCartItem),\r\n        }\r\n      );\r\n\r\n      if (res.status === 500) return;\r\n\r\n      const data = await res.json();\r\n      console.log(data);\r\n\r\n      toast(\"Redirecting to payment gateway...!\");\r\n\r\n      // Redirect to Stripe Checkout\r\n      const { error } = await stripePromise.redirectToCheckout({\r\n        sessionId: data,\r\n      });\r\n\r\n      if (error) {\r\n        console.error(\"Stripe checkout error:\", error);\r\n        toast.error(\"Payment failed.\");\r\n      } else {\r\n        // Save the order after successful payment\r\n        saveOrder(productCartItem);\r\n      }\r\n    } else {\r\n      toast(\"You are not logged in!\");\r\n      setTimeout(() => {\r\n        navigate(\"/login\");\r\n      }, 1000);\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div className=\"p-2 md:p-4\">\r\n      <h2 className=\"text-lg md:text-2xl font-bold text-slate-600\">\r\n        Your Cart Items\r\n      </h2>\r\n\r\n      {productCartItem[0] ? (\r\n        <div className=\"my-4 flex gap-3\">\r\n          {/* Display cart items */}\r\n          <div className=\"w-full max-w-3xl \">\r\n            {productCartItem.map((el) => (\r\n              <CartProduct\r\n                key={el._id}\r\n                id={el._id}\r\n                name={el.name}\r\n                image={el.image}\r\n                category={el.category}\r\n                qty={el.qty}\r\n                total={el.total}\r\n                price={el.price}\r\n              />\r\n            ))}\r\n          </div>\r\n\r\n          {/* Total cart item summary */}\r\n          <div className=\"w-full max-w-md ml-auto\">\r\n            <h2 className=\"bg-blue-500 text-white p-2 text-lg\">Summary</h2>\r\n            <div className=\"flex w-full py-2 text-lg border-b\">\r\n              <p>Total Qty :</p>\r\n              <p className=\"ml-auto w-32 font-bold\">{totalQty}</p>\r\n            </div>\r\n            <div className=\"flex w-full py-2 text-lg border-b\">\r\n              <p>Total Price</p>\r\n              <p className=\"ml-auto w-32 font-bold\">\r\n                <span className=\"text-red-500\">â‚¹</span> {totalPrice}\r\n              </p>\r\n            </div>\r\n            <button\r\n              className=\"bg-red-500 w-full text-lg font-bold py-2 text-white\"\r\n              onClick={handlePayment}\r\n            >\r\n              Payment\r\n            </button>\r\n          </div>\r\n        </div>\r\n      ) : (\r\n        <div className=\"flex w-full justify-center items-center flex-col\">\r\n          <img\r\n            src={emptyCartImage}\r\n            className=\"w-full max-w-sm\"\r\n            alt=\"Empty Cart\"\r\n          />\r\n          <p className=\"text-slate-500 text-3xl font-bold\">Empty Cart</p>\r\n        </div>\r\n      )}\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default Cart;\r\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}